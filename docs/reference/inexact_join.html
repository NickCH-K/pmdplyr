<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Join two data frames inexactly — inexact_join • pmdplyr</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



<meta property="og:title" content="Join two data frames inexactly — inexact_join" />

<meta property="og:description" content="These functions are modifications of the standard dplyr join functions, except that it allows a variable of an ordered type (like date or numeric) in x to be matched in inexact ways to variables in y." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmdplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1.9010</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pmdplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/dplyr_variants.html">pmdplyr: dplyr Variants</a>
    </li>
    <li>
      <a href="../articles/panel_tools.html">pmdplyr: Panel Tools</a>
    </li>
  </ul>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/NickCH-K/pmdplyr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Join two data frames inexactly</h1>
    <small class="dont-index">Source: <a href='https://github.com/NickCH-K/pmdplyr/blob/master/R/inexact_join.R'><code>R/inexact_join.R</code></a></small>
    <div class="hidden name"><code>inexact_join.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>These functions are modifications of the standard <code>dplyr</code> <code>join</code> functions, except that it allows a variable of an ordered type (like date or numeric) in <code>x</code> to be matched in inexact ways to variables in <code>y</code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>inexact_inner_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>suffix</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>".x"</span>,
  <span class='st'>".y"</span>), <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_left_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>suffix</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>".x"</span>,
  <span class='st'>".y"</span>), <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_right_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>suffix</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>".x"</span>,
  <span class='st'>".y"</span>), <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_full_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>suffix</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>".x"</span>,
  <span class='st'>".y"</span>), <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_semi_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_nest_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='kw'>keep</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>,
  <span class='kw'>name</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)

<span class='fu'>inexact_anti_join</span>(<span class='no'>x</span>, <span class='no'>y</span>, <span class='kw'>by</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>copy</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>, <span class='no'>...</span>, <span class='kw'>var</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>method</span>, <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>x, y, by, copy, suffix, keep, name, ...</th>
      <td><p>Arguments to be passed to the relevant <code>join</code> function.</p></td>
    </tr>
    <tr>
      <th>var</th>
      <td><p>Quoted or unquoted variable from the <code>x</code> data frame which is to be indirectly matched.</p></td>
    </tr>
    <tr>
      <th>jvar</th>
      <td><p>Quoted or unquoted variable(s) from the <code>y</code> data frame which are to be indirectly matched. These cannot be variable names also in <code>x</code> or <code>var</code>.</p></td>
    </tr>
    <tr>
      <th>method</th>
      <td><p>The approach to be taken in performing the indirect matching.</p></td>
    </tr>
    <tr>
      <th>exact</th>
      <td><p>A logical, where <code>TRUE</code> indicates that exact matches are acceptable. For example, if <code>method = 'last'</code>, <code>x</code> contains <code>var = 2</code>, and <code>y</code> contains <code>jvar = 1</code> and <code>jvar = 2</code>, then <code>exact = TRUE</code> will match with the <code>jvar = 2</code> observation, and <code>exact = FALSE</code> will match with the <code>jvar = 1</code> observation. If <code>jvar</code> contains two variables and you want them treated differently, set to <code><a href='https://rdrr.io/r/base/c.html'>c(TRUE,FALSE)</a></code> or <code><a href='https://rdrr.io/r/base/c.html'>c(FALSE,TRUE)</a></code>.</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>This allows matching, for example, if one data set contains data from multiple days in the week, while the other data set is weekly. Another example might be matching an observation in one data set to the *most recent* previous observation in the other.</p>
<p>The available methods for matching are:</p>
<ul>
<li><p><code>method = "last"</code> matches <code>var</code> to the closest value of <code>jvar</code> that is *lower*.</p></li>
<li><p><code>method = "next"</code> matches <code>var</code> to the closest value of <code>jvar</code> that is *higher*.</p></li>
<li><p><code>method = "closest"</code> matches <code>var</code> to the closest value of <code>jvar</code>, above or below. If equidistant between two values, picks the lower of the two.</p></li>
<li><p><code>method = "between"</code> requires two variables in <code>jvar</code> which constitute the beginning and end of a range, and matches <code>var</code> to the range it is in. Make sure that the ranges are non-overlapping within the joining variables, or else you will get strange results (specifically, it should join to the earliest-starting range). If the end of one range is the exact start of another, <code>exact = c(TRUE,FALSE)</code> or <code>exact = c(FALSE,TRUE)</code> is recommended to avoid overlaps. Defaults to <code>exact = c(TRUE,FALSE)</code>.</p></li>
</ul>

<p>Note that if, given the method, <code>var</code> finds no proper match, it will be merged with any <code><a href='https://rdrr.io/r/base/NA.html'>is.na(jvar[1])</a></code> values.</p>
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>Scorecard</span>)
<span class='co'># We also have this data on the December unemployment rate for US college grads nationally</span>
<span class='co'># but only every other year</span>
<span class='no'>unemp_data</span> <span class='kw'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(
  <span class='kw'>unemp_year</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>2006</span>, <span class='fl'>2008</span>, <span class='fl'>2010</span>, <span class='fl'>2012</span>, <span class='fl'>2014</span>, <span class='fl'>2016</span>, <span class='fl'>2018</span>),
  <span class='kw'>unemp</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.017</span>, <span class='fl'>.036</span>, <span class='fl'>.048</span>, <span class='fl'>.040</span>, <span class='fl'>.028</span>, <span class='fl'>.025</span>, <span class='fl'>.020</span>)
)
<span class='co'># I want to match the most recent unemployment data I have to each college</span>
<span class='no'>Scorecard</span> <span class='kw'>&lt;-</span> <span class='no'>Scorecard</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>inexact_left_join</span>(<span class='no'>unemp_data</span>,
    <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"last"</span>,
    <span class='kw'>var</span> <span class='kw'>=</span> <span class='no'>year</span>,
    <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='no'>unemp_year</span>
  )</div><div class='output co'>#&gt; <span class='message'>Joining, by = "unemp_year"</span></div><div class='input'>
<span class='co'># Or perhaps I want to find the most recent lagged value (i.e. no exact matches, only recent ones)</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>Scorecard</span>)
<span class='no'>Scorecard</span> <span class='kw'>&lt;-</span> <span class='no'>Scorecard</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>inexact_left_join</span>(<span class='no'>unemp_data</span>,
    <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"last"</span>,
    <span class='kw'>var</span> <span class='kw'>=</span> <span class='no'>year</span>,
    <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='no'>unemp_year</span>,
    <span class='kw'>exact</span> <span class='kw'>=</span> <span class='fl'>FALSE</span>
  )</div><div class='output co'>#&gt; <span class='error'>Error in inexact_join_prep(x = x, y = y, by = by, copy = copy, suffix = suffix,     var = varcall, jvar = jvarcall, method = method, exact = exact): The variable names in jvar should not be in x</span></div><div class='input'>
<span class='co'># Another way to do the same thing would be to specify the range of unemp_years I want exactly</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='no'>Scorecard</span>)
<span class='no'>unemp_data</span>$<span class='no'>unemp_year2</span> <span class='kw'>&lt;-</span> <span class='no'>unemp_data</span>$<span class='no'>unemp_year</span> + <span class='fl'>2</span>
<span class='no'>Scorecard</span> <span class='kw'>&lt;-</span> <span class='no'>Scorecard</span> <span class='kw'>%&gt;%</span>
  <span class='fu'>inexact_left_join</span>(<span class='no'>unemp_data</span>,
    <span class='kw'>method</span> <span class='kw'>=</span> <span class='st'>"between"</span>,
    <span class='kw'>var</span> <span class='kw'>=</span> <span class='no'>year</span>,
    <span class='kw'>jvar</span> <span class='kw'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='no'>unemp_year</span>, <span class='no'>unemp_year2</span>)
  )</div><div class='output co'>#&gt; <span class='error'>Error in inexact_join_prep(x = x, y = y, by = by, copy = copy, suffix = suffix,     var = varcall, jvar = jvarcall, method = method, exact = exact): The variable names in jvar should not be in x</span></div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nick Huntington-Klein, Philip Khor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.9100.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>



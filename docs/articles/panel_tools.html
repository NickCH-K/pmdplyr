<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>pmdplyr: Panel Tools • pmdplyr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="pmdplyr: Panel Tools">
<meta property="og:description" content="pmdplyr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">pmdplyr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/pmdplyr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/dplyr_variants.html">pmdplyr: dplyr Variants</a>
    </li>
    <li>
      <a href="../articles/panel_tools.html">pmdplyr: Panel Tools</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/NickCH-K/pmdplyr/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>pmdplyr: Panel Tools</h1>
                        <h4 class="author">Nick Huntington-Klein, Philip Khor</h4>
            
            <h4 class="date">2020-05-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/NickCH-K/pmdplyr/blob/master/vignettes/panel_tools.Rmd"><code>vignettes/panel_tools.Rmd</code></a></small>
      <div class="hidden name"><code>panel_tools.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">pmdplyr</span>)</pre></body></html></div>
<p>The <code>pmdplyr</code> package is an extension to <code>dplyr</code> designed for cleaning and managing panel and hierarchical data. It contains variations on the <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">dplyr::mutate()</a></code> and <code><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html">dplyr::join()</a></code> functions that address common panel data needs, and contains functions for managing and cleaning panel data.</p>
<p>Unlike other panel data packages, functions in <code>pmdplyr</code> are all designed to work even if there is more than one observation per individual per period. This comes in handy if each individual is observed multiple times per period - for example, multiple classes per student per term; or if you have hierarchical data - for example, multiple companies per country.</p>
<p>There are three vignettes in total describing the contents of <code>pmdplyr</code>:</p>
<ol style="list-style-type: decimal">
<li><p>“pmdplyr”/“Get Started”, which describes the <code>pibble</code> panel data object type, and the <code>pmdplyr</code> tools for creating well-behaved ID and time variables <code><a href="../reference/id_variable.html">id_variable()</a></code> and <code><a href="../reference/time_variable.html">time_variable()</a></code>.</p></li>
<li><p>“dplyr variants”, which that describes <code>pmdplyr</code> variations on <code>dplyr</code> functions <code>mutate()</code> (<code><a href="../reference/mutate_cascade.html">mutate_cascade()</a></code> and <code><a href="../reference/mutate_subset.html">mutate_subset()</a></code>), <code>_join</code> (<code>inexact_join</code> and <code><a href="../reference/safe_join.html">safe_join()</a></code>), and <code>lag</code> (<code><a href="../reference/tlag.html">tlag()</a></code>).</p></li>
<li><p><strong>CURRENT VIGNETTE</strong> “Panel Tools”, which describes novel tools that <code>pmdplyr</code> provides for cleaning and manipulating panel data (<code><a href="../reference/panel_fill.html">panel_fill()</a></code>, <code><a href="../reference/panel_locf.html">panel_locf()</a></code>, <code><a href="../reference/fixed_check.html">fixed_check()</a></code>, <code><a href="../reference/fixed_force.html">fixed_force()</a></code>, <code><a href="../reference/panel_calculations.html">between_i()</a></code>, <code><a href="../reference/panel_calculations.html">within_i()</a></code>, <code><a href="../reference/mode_order.html">mode_order()</a></code>).</p></li>
</ol>
<hr>
<div id="filling-in-data" class="section level1">
<h1 class="hasAnchor">
<a href="#filling-in-data" class="anchor"></a>Filling in Data</h1>
<p>In a panel data context, missing data can be categorized into two kinds: explicit missing values for certain observations (<code>NA</code>s), or observations that are missing entirely - for example if person <code>1</code> has observations in period <code>1</code> and period <code>3</code>, but not period <code>2</code>.</p>
<p>You may wish to fill in either of these kinds of missing data using the data you do have.</p>
<div id="panel_fill" class="section level2">
<h2 class="hasAnchor">
<a href="#panel_fill" class="anchor"></a>panel_fill()</h2>
<p><code><a href="../reference/panel_fill.html">panel_fill()</a></code> will fill in gaps between time periods for individuals. For example, if person <code>1</code> has observations in period <code>1</code> and period <code>3</code>, but not period <code>2</code>, then <code><a href="../reference/panel_fill.html">panel_fill()</a></code> will add an observation to the data for person <code>1</code> in time period <code>2</code>. If there is more than one observation for person <code>1</code> in period <code>1</code>, then all of them will be copied for period <code>2</code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="../reference/panel_fill.html">panel_fill</a></span>(<span class="no">.df</span>,
  <span class="kw">.set_NA</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">.min</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">.max</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">.backwards</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">.group_i</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">.flag</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">.i</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.d</span> <span class="kw">=</span> <span class="fl">1</span>,
  <span class="kw">.uniqcheck</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">.setpanel</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)</pre></body></html></div>
<p><code><a href="../reference/panel_fill.html">panel_fill()</a></code> will give us some newly-created observations, and we need to decide what to fill them in with. By default, it will fill in values using what we see in the most recent non-missing observation. But we can set <code>.backwards = TRUE</code> to use the <em>next</em> non-missing observation instead, or use <code>.set_NA</code> to fill the new observations with <code>NA</code>.</p>
<p><code>.set_NA</code> is a character vector of variable names that should be set to <code>NA</code> for newly-created observations, or set to <code>TRUE</code> to set everything except <code>.i</code> and <code>.t</code> to <code>NA</code>. You can also create a new variable indicating which observations are newly-created with <code>.flag</code>.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Note the gap between periods 2 and 4 for person 1.</span>
<span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pibble.html">pibble</a></span>(
  <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>),
  <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">6</span>,
  <span class="kw">y</span> <span class="kw">=</span> <span class="fl">7</span>:<span class="fl">12</span>,
  <span class="kw">.i</span> <span class="kw">=</span> <span class="no">i</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="no">t</span>
)

<span class="fu"><a href="../reference/panel_fill.html">panel_fill</a></span>(<span class="no">df</span>, <span class="kw">.set_NA</span> <span class="kw">=</span> <span class="st">"y"</span>, <span class="kw">.flag</span> <span class="kw">=</span> <span class="st">"new_obs"</span>)
<span class="co">#&gt; # A pibble:                         7 x 5</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Time variable (.t):               t [5]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     t     x     y new_obs</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt; &lt;lgl&gt;  </span>
<span class="co">#&gt; 1     1     2     1     7 FALSE  </span>
<span class="co">#&gt; 2     1     3     1    NA TRUE   </span>
<span class="co">#&gt; 3     1     4     2     8 FALSE  </span>
<span class="co">#&gt; 4     1     5     3     9 FALSE  </span>
<span class="co">#&gt; 5     2     1     4    10 FALSE  </span>
<span class="co">#&gt; 6     2     2     5    11 FALSE  </span>
<span class="co">#&gt; 7     2     3     6    12 FALSE</span>
<span class="fu"><a href="../reference/panel_fill.html">panel_fill</a></span>(<span class="no">df</span>, <span class="kw">.set_NA</span> <span class="kw">=</span> <span class="st">"y"</span>, <span class="kw">.backwards</span> <span class="kw">=</span> <span class="fl">TRUE</span>)$<span class="no">x</span>
<span class="co">#&gt; [1] 1 2 2 3 4 5 6</span></pre></body></html></div>
<p>By default, <code><a href="../reference/panel_fill.html">panel_fill()</a></code> will only fill in gaps between existing observations. However, commonly we might want to create new observations outside of the existing range, perhaps to create a fully balanced panel for ourselves. <code>.min</code> and <code>.max</code> will ensure that each individual has observations at least as far back as <code>.min</code>, and at least as far out as <code>.max</code>. Set <code>.min = min(t)</code> and <code>.max = max(t)</code> (where <code>t</code> is your time variable) to ensure a fully balanced panel.</p>
<p>Data for the outside-the-observed-range values will be taken from the closest observed value.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="fu"><a href="../reference/panel_fill.html">panel_fill</a></span>(<span class="no">df</span>, <span class="kw">.min</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span>(<span class="no">df</span>$<span class="no">t</span>), <span class="kw">.max</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="no">df</span>$<span class="no">t</span>))
<span class="co">#&gt; # A pibble:                         10 x 4</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Time variable (.t):               t [5]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;        i     t     x     y</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     1     1     1     7</span>
<span class="co">#&gt;  2     1     2     1     7</span>
<span class="co">#&gt;  3     1     3     1     7</span>
<span class="co">#&gt;  4     1     4     2     8</span>
<span class="co">#&gt;  5     1     5     3     9</span>
<span class="co">#&gt;  6     2     1     4    10</span>
<span class="co">#&gt;  7     2     2     5    11</span>
<span class="co">#&gt;  8     2     3     6    12</span>
<span class="co">#&gt;  9     2     4     6    12</span>
<span class="co">#&gt; 10     2     5     6    12</span></pre></body></html></div>
<p>The rest of the options include <code>.group_i</code> (by default, if <code>.i</code> can be found, data will be filled within-individual. Set <code>.group_i = FALSE</code> to ignore this), and standard arguments related to declaring the panel structure of the data (<code>.i</code>, <code>.t</code>, <code>.d</code>, <code>.uniqcheck</code>, see the “pibble” section above). <code>.setpanel</code> ensures that if you declare the panel structure in the <code><a href="../reference/panel_fill.html">panel_fill()</a></code> function, it will be maintained in the object you get back.</p>
</div>
<div id="panel_locf" class="section level2">
<h2 class="hasAnchor">
<a href="#panel_locf" class="anchor"></a>panel_locf()</h2>
<p><code><a href="../reference/panel_locf.html">panel_locf()</a></code> (“last observation carried forward”) will fill in explicit <code>NA</code> values using recently available data. It is very similar to <code><a href="https://rdrr.io/pkg/zoo/man/na.locf.html">zoo::na.locf()</a></code> except that it respects panel structure and is more flexible.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="../reference/panel_locf.html">panel_locf</a></span>(<span class="no">.var</span>,
  <span class="kw">.df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"."</span>, <span class="kw">envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span>()),
  <span class="kw">.fill</span> <span class="kw">=</span> <span class="fl">NA</span>,
  <span class="kw">.backwards</span> <span class="kw">=</span> <span class="fl">FALSE</span>,
  <span class="kw">.resolve</span> <span class="kw">=</span> <span class="st">"error"</span>,
  <span class="kw">.group_i</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">.i</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.d</span> <span class="kw">=</span> <span class="fl">1</span>,
  <span class="kw">.uniqcheck</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)</pre></body></html></div>
<p>where <code>.var</code> is the variable to be filled in, and <code>.df</code> is the data set that variable lives in. If the data set is being passed in via <code>%&gt;% mutate()</code> or similar, then <code>.df</code> will automatically pick it up and you don’t need to specify it.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pibble.html">pibble</a></span>(
  <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>),
  <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">NA</span>, <span class="fl">3</span>, <span class="fl">NA</span>, -<span class="fl">3</span>, <span class="fl">4</span>),
  <span class="kw">.i</span> <span class="kw">=</span> <span class="no">i</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="no">t</span>
)

<span class="co"># Notice that the fourth observation doesn't get filled in</span>
<span class="co"># because it's the first observation for person 2, so nothing to fill in from</span>
<span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">x_filled</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel_locf.html">panel_locf</a></span>(<span class="no">x</span>))
<span class="co">#&gt; # A pibble:                         6 x 4</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Time variable (.t):               t [4]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     t     x x_filled</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     1     1        1</span>
<span class="co">#&gt; 2     1     2    NA        1</span>
<span class="co">#&gt; 3     1     3     3        3</span>
<span class="co">#&gt; 4     2     2    NA       NA</span>
<span class="co">#&gt; 5     2     3    -3       -3</span>
<span class="co">#&gt; 6     2     4     4        4</span></pre></body></html></div>
<p>You have a fair amount of control over how filling-in works. By default, data will be filled in using the most recent previous observation. But <code>.backwards = TRUE</code> will use the <em>next upcoming</em> observation instead. Also, by default, only <code>NA</code> values will be overwritten. But <code>.fill</code> will allow you to specify a vector of values (perhaps including <code>NA</code>) to be overwritten. This can be handy if you’re working with data that uses missingness indicators other than <code>NA</code>.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="no">df</span> <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(
  <span class="kw">x_filled</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel_locf.html">panel_locf</a></span>(<span class="no">x</span>, <span class="kw">.backwards</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">x_no_neg3</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel_locf.html">panel_locf</a></span>(<span class="no">x</span>, <span class="kw">.backwards</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">.fill</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>, -<span class="fl">3</span>))
)
<span class="co">#&gt; # A pibble:                         6 x 5</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Time variable (.t):               t [4]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     t     x x_filled x_no_neg3</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     1     1        1         1</span>
<span class="co">#&gt; 2     1     2    NA        3         3</span>
<span class="co">#&gt; 3     1     3     3        3         3</span>
<span class="co">#&gt; 4     2     2    NA       -3         4</span>
<span class="co">#&gt; 5     2     3    -3       -3         4</span>
<span class="co">#&gt; 6     2     4     4        4         4</span></pre></body></html></div>
<p><code><a href="../reference/panel_locf.html">panel_locf()</a></code> will work even if <code>.i</code> and <code>.t</code> don’t uniquely identify the observations. However, this presents a problem! If there are <em>different values</em> of <code>.var</code> for a given combination of <code>.i</code> and <code>.t</code>, then which value do we choose to use for the purpose of filling in other observations? <code>.resolve</code> makes this choice. By default, there will be an “error” if values of <code>.var</code> are inconsistent within <code>.i</code> and <code>.t</code>. Or, set <code>.resolve</code> to a summary function like <code>.resolve = mean</code> or <code>.resolve = function(x) mean(x, na.rm = TRUE)</code> to resolve inconsistencies before filling in. If you have some <code>.i</code>/<code>.t</code> combinations with both missing and non-missing values, the missing values will be filled in using the same function.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">inconsistent_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pibble.html">pibble</a></span>(
  <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">t</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>),
  <span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">NA</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">3</span>),
  <span class="kw">.i</span> <span class="kw">=</span> <span class="no">i</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="no">t</span>
)

<span class="no">inconsistent_df</span> <span class="kw">%&gt;%</span> <span class="fu">mutate</span>(
  <span class="kw">x_filled</span> <span class="kw">=</span>
    <span class="fu"><a href="../reference/panel_locf.html">panel_locf</a></span>(<span class="no">x</span>, <span class="kw">.resolve</span> <span class="kw">=</span> <span class="no">mean</span>)
)
<span class="co">#&gt; # A pibble:                         6 x 4</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Time variable (.t):               t [3]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     t     x x_filled</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1     1     1      1  </span>
<span class="co">#&gt; 2     1     1     2      2  </span>
<span class="co">#&gt; 3     1     2    NA      1.5</span>
<span class="co">#&gt; 4     2     1     1      1  </span>
<span class="co">#&gt; 5     2     2     2      2  </span>
<span class="co">#&gt; 6     2     3     3      3</span></pre></body></html></div>
<p>The rest of the options include <code>.group_i</code> (by default, if <code>.i</code> can be found, data will be filled within-individual. Set <code>.group_i = FALSE</code> to ignore this), and standard arguments related to declaring the panel structure of the data (<code>.i</code>, <code>.t</code>, <code>.d</code>, <code>.uniqcheck</code>, see the “pibble” section above).</p>
<hr>
</div>
</div>
<div id="panel-consistency" class="section level1">
<h1 class="hasAnchor">
<a href="#panel-consistency" class="anchor"></a>Panel Consistency</h1>
<p>In panel data, and especially hierarchical data, there are some variables that should be <em>fixed</em> within values of other variables. And if they’re not, you have a problem!</p>
<p>For example, consider the data set</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">continent</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"Asia"</span>, <span class="st">"Europe"</span>, <span class="st">"Europe"</span>, <span class="st">"S America"</span>, <span class="st">"S America"</span>),
  <span class="kw">country</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"France"</span>, <span class="st">"France"</span>, <span class="st">"France"</span>, <span class="st">"Brazil"</span>, <span class="st">"Brazil"</span>),
  <span class="kw">year</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2000</span>, <span class="fl">2001</span>, <span class="fl">2002</span>, <span class="fl">2000</span>, <span class="fl">2001</span>)
)

<span class="no">df</span>
<span class="co">#&gt;   continent country year</span>
<span class="co">#&gt; 1      Asia  France 2000</span>
<span class="co">#&gt; 2    Europe  France 2001</span>
<span class="co">#&gt; 3    Europe  France 2002</span>
<span class="co">#&gt; 4 S America  Brazil 2000</span>
<span class="co">#&gt; 5 S America  Brazil 2001</span></pre></body></html></div>
<p>The variable <code>continent</code> should never change within values of <code>country</code> - a country can’t change the continent it’s on! The fact that France changes continents from year to year in this data should be regarded as very fishy. It will be handy to spot these sorts of potential errors in your data set, and fix them if you think you know how.</p>
<div id="fixed_check" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed_check" class="anchor"></a>fixed_check()</h2>
<p><code><a href="../reference/fixed_check.html">fixed_check()</a></code> will look in your data <code>.df</code> for inconsistencies in the value of some variables <code>.var</code> within values of other variables <code>.within</code>.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="../reference/fixed_check.html">fixed_check</a></span>(<span class="no">.df</span>,
  <span class="kw">.var</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.within</span> <span class="kw">=</span> <span class="kw">NULL</span>
)</pre></body></html></div>
<p>You should pick variables for <code>.var</code> that are supposed to be constant within combinations of <code>.within</code>.</p>
<p>If your data has problems and is inconsistent, <code><a href="../reference/fixed_check.html">fixed_check()</a></code> will retun a list of data sets, one for each <code>.var</code> variable, containing the subset of the data that gives you problems. For our <code>df</code> with the France problem, that’s all of the France observations!</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/fixed_check.html">fixed_check</a></span>(<span class="no">df</span>, <span class="kw">.var</span> <span class="kw">=</span> <span class="no">continent</span>, <span class="kw">.within</span> <span class="kw">=</span> <span class="no">country</span>)$<span class="no">continent</span>
<span class="co">#&gt; # A tibble: 3 x 3</span>
<span class="co">#&gt;   continent country  year</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Asia      France   2000</span>
<span class="co">#&gt; 2 Europe    France   2001</span>
<span class="co">#&gt; 3 Europe    France   2002</span></pre></body></html></div>
<p>If your data is fine, and all <code>.var</code> variables are indeed constant within combinations of <code>.within</code>, then <code><a href="../reference/fixed_check.html">fixed_check()</a></code> will return <code>TRUE</code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">consistent_df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span>(
  <span class="kw">state</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">year</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2000</span>, <span class="fl">2001</span>, <span class="fl">2001</span>, <span class="fl">2000</span>, <span class="fl">2000</span>, <span class="fl">2001</span>),
  <span class="kw">treatment</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">F</span>, <span class="no">T</span>, <span class="no">T</span>, <span class="no">T</span>, <span class="no">T</span>, <span class="no">F</span>),
  <span class="kw">outcome</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">4.4</span>, <span class="fl">3.2</span>, <span class="fl">3.4</span>, <span class="fl">5.5</span>, <span class="fl">5.6</span>, <span class="fl">8</span>)
)

<span class="co"># Since this policy treatment is administered on the state level,</span>
<span class="co"># everyone in the same state/year should get the same treatment.</span>
<span class="co"># And they do!</span>
<span class="fu"><a href="../reference/fixed_check.html">fixed_check</a></span>(<span class="no">consistent_df</span>, <span class="kw">.var</span> <span class="kw">=</span> <span class="no">treatment</span>, <span class="kw">.within</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="no">state</span>, <span class="no">year</span>))
<span class="co">#&gt; [1] TRUE</span></pre></body></html></div>
<p>Some handy <code><a href="../reference/fixed_check.html">fixed_check()</a></code> tips:</p>
<ol style="list-style-type: decimal">
<li>
<code><a href="../reference/fixed_check.html">fixed_check()</a></code> returns either a <code>logical</code> or a <code>list</code> depending on the outcome. If you want to just get <code>FALSE</code> instead of a list of data sets, do <code><a href="https://rdrr.io/r/base/logical.html">is.logical(fixed_check())</a></code> instead of <code><a href="../reference/fixed_check.html">fixed_check()</a></code>.</li>
<li>If you do have problems and want a consistent data set, you can fix things by hand as you like, or you can use <code><a href="../reference/fixed_force.html">fixed_force()</a></code> (see below) to change the observations to be consistent, or to drop all inconsistent observations with <code><a href="../reference/fixed_force.html">fixed_force(.resolve = "drop")</a></code>.</li>
</ol>
</div>
<div id="fixed_force" class="section level2">
<h2 class="hasAnchor">
<a href="#fixed_force" class="anchor"></a>fixed_force()</h2>
<p><code><a href="../reference/fixed_force.html">fixed_force()</a></code> will take a data set <code>.df</code>, find any inconsistencies in the variables <code>.var</code> within combinations of the variables <code>.within</code>, and will “fix” those inconsistencies, using the function <code>.resolve</code> to select the correct values. It can flag any changed values with a new variable named <code>.flag</code>.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/fixed_force.html">fixed_force</a></span>(<span class="no">.df</span>,
  <span class="kw">.var</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.within</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.resolve</span> <span class="kw">=</span> <span class="no">mode_order</span>,
  <span class="kw">.flag</span> <span class="kw">=</span> <span class="fl">NA</span>
)</pre></body></html></div>
<p>The default resolution function is <code><a href="../reference/mode_order.html">mode_order()</a></code> (see the Additional Calculations section), which calculates the mode, selecting the first-ordered value in the data if there are ties. The mode seems most relevant here, since the most likely (and responsible) use for <code><a href="../reference/fixed_force.html">fixed_force()</a></code> is when you have data that is mostly correct but just has a few odd values that are likely just miscodes. <code><a href="../reference/mode_order.html">mode_order()</a></code> also is not just limited to numeric variables.</p>
<p>Continuing with our France-in-Asia data set,</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="fu"><a href="../reference/fixed_force.html">fixed_force</a></span>(<span class="no">df</span>, <span class="kw">.var</span> <span class="kw">=</span> <span class="no">continent</span>, <span class="kw">.within</span> <span class="kw">=</span> <span class="no">country</span>, <span class="kw">.flag</span> <span class="kw">=</span> <span class="st">"altered"</span>)
<span class="co">#&gt; # A tibble: 5 x 4</span>
<span class="co">#&gt;   continent country  year altered</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt; &lt;lgl&gt;  </span>
<span class="co">#&gt; 1 Europe    France   2000 TRUE   </span>
<span class="co">#&gt; 2 Europe    France   2001 FALSE  </span>
<span class="co">#&gt; 3 Europe    France   2002 FALSE  </span>
<span class="co">#&gt; 4 S America Brazil   2000 FALSE  </span>
<span class="co">#&gt; 5 S America Brazil   2001 FALSE</span></pre></body></html></div>
<p>Another option for <code>.resolve</code> is to set <code>.resolve = "drop"</code> (or any other character, really), and it will drop the inconsistent observations.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu"><a href="../reference/fixed_force.html">fixed_force</a></span>(<span class="no">df</span>, <span class="kw">.var</span> <span class="kw">=</span> <span class="no">continent</span>, <span class="kw">.within</span> <span class="kw">=</span> <span class="no">country</span>, <span class="kw">.resolve</span> <span class="kw">=</span> <span class="st">"drop"</span>)
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   continent country  year</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;   &lt;dbl&gt;</span>
<span class="co">#&gt; 1 S America Brazil   2000</span>
<span class="co">#&gt; 2 S America Brazil   2001</span></pre></body></html></div>
<hr>
</div>
</div>
<div id="additional-calculations" class="section level1">
<h1 class="hasAnchor">
<a href="#additional-calculations" class="anchor"></a>Additional Calculations</h1>
<p><code>pmdplyr</code> contains several additional functions that produce calculations of interest.</p>
<div id="between_i" class="section level2">
<h2 class="hasAnchor">
<a href="#between_i" class="anchor"></a>between_i()</h2>
<p><code><a href="../reference/panel_calculations.html">between_i()</a></code> performs the <em>between transformation</em>. In particular, it isolates the variation between <code>.i</code> groups in a variable <code>.var</code>, throwing out all variation within <code>.i</code> groups. The result is identical within combinations of <code>.i</code>.</p>
<p>The specific calculation that is performed is</p>
<p><span class="math display">\[between.i(x) = \bar{x}_i - \bar{x}\]</span></p>
<p>where <span class="math inline">\(\bar{x}_i\)</span> is the mean of <code>x</code> within the <code>.i</code> groups, and <span class="math inline">\(\bar{x}\)</span> is the grand mean of <code>x</code> over all observations.</p>
<p>Be aware that this is different from <code><a href="https://rdrr.io/pkg/plm/man/pseries.html">plm::between()</a></code>, which returns <span class="math inline">\(\bar{x}_i\)</span> and does not subtract out <span class="math inline">\(\bar{x}\)</span>.</p>
<p>The syntax for <code><a href="../reference/panel_calculations.html">between_i()</a></code> is:</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="../reference/panel_calculations.html">between_i</a></span>(<span class="no">.var</span>,
  <span class="kw">.df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"."</span>, <span class="kw">envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span>()),
  <span class="kw">.fcn</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">.i</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">uniqcheck</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)</pre></body></html></div>
<p>Where <code>.var</code> is the variable on which the transformation is performed, and <code>.df</code> is the data set. If the data set is being passed in via <code>%&gt;% mutate()</code> or similar, then <code>.df</code> will automatically pick it up and you don’t need to specify it. <code>.fcn</code> is the function applied to calculate the group and grand values, i.e. <span class="math inline">\(.fcn(x) = \bar{x}\)</span>. The standard definition of the between transformation is for this to be the mean, but it has been left flexible.</p>
<p>The rest of the options include standard arguments related to declaring the panel structure of the data (<code>.i</code>, <code>.t</code>, <code>.uniqcheck</code>, see the “pibble” section above). <code>.d</code> is omitted because it is irrelevant to the calculation.</p>
<p>An example of the between transformation follows:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pibble.html">pibble</a></span>(
  <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>,
  <span class="kw">.i</span> <span class="kw">=</span> <span class="no">i</span>
) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">between_x</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel_calculations.html">between_i</a></span>(<span class="no">x</span>))

<span class="co"># Notice that the grand mean is...</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">df</span>$<span class="no">x</span>)
<span class="co">#&gt; [1] 2.5</span>
<span class="co"># And the mean within groups is...</span>
<span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">i</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>))
<span class="co">#&gt; # A pibble:                         2 x 2</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     x</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1   1.5</span>
<span class="co">#&gt; 2     2   3.5</span>

<span class="co"># So the between calculation should be</span>
<span class="co"># 1.5 - 2.5 = -1 and 3.5 - 2.5 = 1 for the different groups:</span>
<span class="no">df</span>$<span class="no">between_x</span>
<span class="co">#&gt; [1] -1 -1  1  1</span></pre></body></html></div>
</div>
<div id="within_i" class="section level2">
<h2 class="hasAnchor">
<a href="#within_i" class="anchor"></a>within_i()</h2>
<p><code><a href="../reference/panel_calculations.html">within_i()</a></code> performs the <em>within transformation</em>. In particular, it isolates the variation within <code>.i</code> groups in a variable <code>.var</code>, throwing out all variation between <code>.i</code> groups. The result averages out to <code>0</code> within combinations of <code>.i</code>.</p>
<p>The specific calculation that is performed is</p>
<p><span class="math display">\[within.i(x) = x_i - \bar{x}_i\]</span></p>
<p>where <span class="math inline">\(\bar{x}_i\)</span> is the mean of <code>x</code> within the <code>.i</code> groups.</p>
<p>The syntax for <code>within_i</code> is:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="../reference/panel_calculations.html">within_i</a></span>(<span class="no">.var</span>,
  <span class="kw">.df</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/get.html">get</a></span>(<span class="st">"."</span>, <span class="kw">envir</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html">parent.frame</a></span>()),
  <span class="kw">.fcn</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>, <span class="kw">na.rm</span> <span class="kw">=</span> <span class="fl">TRUE</span>),
  <span class="kw">.i</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">.t</span> <span class="kw">=</span> <span class="kw">NULL</span>,
  <span class="kw">uniqcheck</span> <span class="kw">=</span> <span class="fl">FALSE</span>
)</pre></body></html></div>
<p>Where <code>.var</code> is the variable on which the transformation is performed, and <code>.df</code> is the data set. If the data set is being passed in via <code>%&gt;% mutate()</code> or similar, then <code>.df</code> will automatically pick it up and you don’t need to specify it. <code>.fcn</code> is the function applied to calculate the group values, i.e. <span class="math inline">\(.fcn(x) = \bar{x}\)</span>. The standard definition of the within transformation is for this to be the mean, but it has been left flexible.</p>
<p>The rest of the options include standard arguments related to declaring the panel structure of the data (<code>.i</code>, <code>.t</code>, <code>.uniqcheck</code>, see the “pibble” section above). <code>.d</code> is omitted because it is irrelevant to the calculation.</p>
<p>An example of the between transformation follows:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">df</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/pibble.html">pibble</a></span>(
  <span class="kw">i</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>),
  <span class="kw">x</span> <span class="kw">=</span> <span class="fl">1</span>:<span class="fl">4</span>,
  <span class="kw">.i</span> <span class="kw">=</span> <span class="no">i</span>
) <span class="kw">%&gt;%</span>
  <span class="fu">mutate</span>(<span class="kw">within_x</span> <span class="kw">=</span> <span class="fu"><a href="../reference/panel_calculations.html">within_i</a></span>(<span class="no">x</span>))

<span class="co"># Notice that the mean within groups is...</span>
<span class="no">df</span> <span class="kw">%&gt;%</span>
  <span class="fu">group_by</span>(<span class="no">i</span>) <span class="kw">%&gt;%</span>
  <span class="fu">summarize</span>(<span class="kw">x</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span>(<span class="no">x</span>))
<span class="co">#&gt; # A pibble:                         2 x 2</span>
<span class="co">#&gt; # Individual-level identifier (.i): i [2]</span>
<span class="co">#&gt; # Gap (.d):                         1</span>
<span class="co">#&gt;       i     x</span>
<span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     1   1.5</span>
<span class="co">#&gt; 2     2   3.5</span>

<span class="co"># So the between calculation should be</span>
<span class="co"># 1 - 1.5 = -.5 and 2 - 1.5 = .5 for individual 1</span>
<span class="co"># and 3 - 3.5 = -.5 and 4 - 3.5 = .5 individual 2:</span>
<span class="no">df</span>$<span class="no">within_x</span>
<span class="co">#&gt; [1] -0.5  0.5 -0.5  0.5</span></pre></body></html></div>
</div>
<div id="mode_order" class="section level2">
<h2 class="hasAnchor">
<a href="#mode_order" class="anchor"></a>mode_order()</h2>
<p>R does not have a base function for calculating the mode of a vector. But <code><a href="../reference/fixed_force.html">fixed_force()</a></code> wanted one, and so here we are. This function has been exported for general use in case it comes in handy elsewhere.</p>
<p>In particular, <code><a href="../reference/mode_order.html">mode_order()</a></code> calculates the mode of a vector and, if there are ties between two different values, selects the one that comes earlier in the original vector order.</p>
<div class="sourceCode" id="cb20"><html><body><pre class="r"><span class="co"># 2 appears twice while everything else appears once; 2 is the mode.</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">NA</span>, <span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">4</span>)
<span class="fu"><a href="../reference/mode_order.html">mode_order</a></span>(<span class="no">x</span>)
<span class="co">#&gt; [1] 2</span>

<span class="co"># 1 or 2 could be the mode.</span>
<span class="co"># Ties are broken by order in the vector.</span>
<span class="no">x</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">1</span>)
<span class="fu"><a href="../reference/mode_order.html">mode_order</a></span>(<span class="no">x</span>)
<span class="co">#&gt; [1] 2</span></pre></body></html></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nick Huntington-Klein, Philip Khor.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
